# **八字四柱日柱與時柱之精確計算法則與開源專案分析報告**

本報告旨在針對八字四柱命理學中，日柱（日干支）與時柱（時干支）的推算算法進行深入且詳盡的技術分析。八字排盤是一門將出生時刻轉換為干支紀年的精密計量學，其中，年柱與月柱依賴於二十四節氣的精確交節時刻，而日柱與時柱則分別依賴於連續的數學週期計數和複雜的地理時間校正。本分析將聚焦於日柱與時柱的計算模型，並探討目前流行的開源專案在處理這些計時複雜性時所採取的策略。

## ---

**I. 曆法基礎與定義框架**

在深入探討日柱與時柱的計算前，必須明確八字命理學的曆法基礎。八字系統本質上並非純粹的陰曆或農曆，而是一套嚴格依據天文太陽運行軌跡（Solar Ephemeris）建立的計時系統。

### **I.A. 八字中的雙重曆法系統**

八字四柱的確定，特別是年柱與月柱，仰賴於太陽曆。一個八字月份的起始，並非依循農曆初一，而是取決於二十四節氣中「節」（*Jie Qi*, 節氣）的精確交節時刻。例如，寅月的開始標誌是立春 1。這種對太陽位置的嚴格要求，使得八字計時從根本上區別於一般民用曆法，並要求在計算年柱與月柱時，必須採用高精度的天文曆表數據。

例如，立春通常發生在2月4日或5日，而驚蟄則在3月5日或6日 1。這些精確的時刻界定了月份的干支轉換點，為後續的日柱和時柱計算提供了必要的上下文。

### **I.B. 六十甲子的數學性質**

八字計算的數學基石是六十甲子（Sexagenary Cycle），它結合了十個天干（Celestial Stems）與十二個地支（Earthly Branches），形成一個60單位一循環的週期。日柱和時柱的推算，都將以這個模數60的數學週期為核心 2。這種穩定的循環性，使得干支計算得以運用模數算術（Modulo Arithmetic）進行編程和推導。

## ---

**II. 日柱（日干支）的算法推導**

日柱的計算是四柱中最具線性數學特徵的部分，它不依賴於節氣的精確時刻，而是依靠時間的連續性和模數60的週期性。

### **II.A. 日曆映射：連續計日系統**

由於日柱干支是持續不間斷地以60為週期進行輪轉，不因節氣、月相或曆法邊界而重設，因此計算上必須依賴一個連續的計日系統，如儒略日（Julian Day, JD）或修正儒略日（Modified Julian Day, MJD）編號系統。

計算步驟通常是選定一個已知的基準日期（epoch），確定該基準日的甲子序號 ($I\_0$)。研究資料指出，例如西元1981年2月14日是癸亥日，可作為計算起點 2。

### **II.B. 模數60計算：日差 ($\\Delta D$) 的公式化**

計算目標日期的日柱索引 ($I\_T$) 涉及計算基準日期 ($D\_0$) 與目標日期 ($D\_T$) 之間相隔的總日數 ($\\Delta D$)，並將該差值與基準日的甲子序號 $I\_0$ 相加後，進行模數60的運算。

$$I\_T \= (I\_0 \+ \\Delta D) \\mod 60$$  
得到總序號 $I\_T$ 後，即可分解出天干序號 ($h\_d$) 和地支序號 ($e\_d$)：

$$h\_d \= (I\_T \- 1\) \\mod 10 \\quad \\text{(天干索引, 0-9)}$$

$$e\_d \= (I\_T \- 1\) \\mod 12 \\quad \\text{(地支索引, 0-11)}$$  
例如，若總日差 $\\Delta D$ 經複雜計算後得出有效差值為32，則天干序號 $h\_d \= 32 \\mod 10 \= 2$，地支序號 $e\_d \= 32 \\mod 12 \= 8$ 2。若起始點為癸亥日（索引60或0），則索引2對應乙，索引8對應未，最終結果為乙未日 2。

#### **III.B.1. 計算可靠性與曆法變動的分析**

日柱對固定模數算術的依賴性使其成為四柱中最具計算穩定性且歧義最少的要素。這與年柱和月柱必須依賴不斷變化的天文曆表來確定精確的節氣時刻形成鮮明對比 1。因此，計算模型在處理大量日期時，可優先利用日柱的線性方法進行時間線的骨架構建。

然而，精確性仍受制於起算點曆法的嚴謹性。研究指出，即使是日柱的計算，在跨越數十年甚至百年時，亦會出現偏移。例如，1981年和2061年的癸亥日都落在2月14日，但到了2141年，癸亥日卻變為2月13日 2。這種日期偏移表明，日柱的60日循環並非完全與曆法年精確同步，累積的閏年誤差和世紀修正規則必須被準確納入$\\Delta D$的計算中。因此，要確保跨越廣泛時間範圍的日柱計算正確無誤，計算模型必須整合全面處理公曆規則（包括閏年規則和曆法改革）的日曆庫。

Day Pillar Modular Mapping and Indices

| 組件 | 模數 | 索引範圍 (計算上) | 範例: 索引 32 (乙未) |
| :---- | :---- | :---- | :---- |
| 六十甲子總索引 ($I\_T$) | Mod 60 | 1 (甲子) 至 60 (癸亥) | 32 |
| 天干索引 ($h\_d$) | Mod 10 | 1 (甲) 至 10 (癸) | 2 (乙) |
| 地支索引 ($e\_d$) | Mod 12 | 1 (子) 至 12 (亥) | 8 (未) |

## ---

**III. 時柱計算的前提：真太陽時的必要性**

日柱確定後，推算時柱（時干支）的第一步是精確確立出生時間點對應的本地時辰地支。這一步無法依賴民用標準時間，而必須以真太陽時（True Solar Time）為準。

### **III.A. 標準時間與真太陽時的差異**

真太陽時是根據太陽在天空中的實際位置所計算的時間。傳統八字理論要求，真太陽時必須確保太陽在每天中午12點時，準確地處於正南方 3。由於標準時間是依據政治劃定的時區經線（例如北京時間以東經120度為準）來統一設定的，它無法反映各地區實際的太陽起落時間。若直接使用標準時間來推算時辰，將導致系統性誤差，尤其對於時辰轉換點附近的出生命例，極可能導致時柱錯誤 3。因此，計算八字必須使用真太陽時 3。

### **III.B. 計算時間校正的兩個關鍵組成部分**

要將民用標準時間轉換為真太陽時，至少需要進行兩項關鍵校正：

#### **III.B.1. 經度校正（Local Mean Solar Time, LMST）**

標準時間依賴於一個固定的標準經線。本地的平均太陽時間（LMST）必須根據出生地的實際經度 ($L$) 進行修正。  
校正原理：計算標準經度 ($L\_{Standard}$) 與本地經度 ($L\_{Local}$) 之間的差值。時差（以分鐘計）大約為 $4 \\times (L\_{Standard} \- L\_{Local})$。此修正直接調整了八字時辰的邊界，使之與地理位置相符 3。

#### **III.B.2. 均時差校正（Equation of Time, EOT）**

雖然研究資料沒有提供詳細的公式 3，但計算工具要求時間修正必須根據「一年中的不同日期」進行 3。這隱含了對均時差（Equation of Time, EOT）的納入。  
均時差功能：EOT校正地球軌道為橢圓形和地軸傾斜所造成的影響，導致真太陽的運行速度與平均太陽的運行速度存在差異。這個校正值在一年中可以造成高達$\\pm 16$分鐘的偏差。  
在實務上，許多簡化的八字計算器往往僅應用經度校正，而忽略了均時差。然而，忽略均時差將違反真太陽時的準確性要求 3，並且是導致時柱計算錯誤的最大潛在來源。由於八字時辰（雙小時）的邊界轉換對時間精度極為敏感，數分鐘的誤差即可導致時辰的變化，因此納入EOT對於確保計算的準確性至關重要。

### **III.C. 應用：確定十二時辰**

經度校正和均時差校正後的真太陽時，被用來準確映射出生時間至十二地支（十二時辰）。例如，子時通常指晚間23點至凌晨1點 4。在計算中，必須將這個區間轉換為本地的「真太陽時」23:00至01:00，以界定該時辰的準確邊界。

真太陽時的必要性意味著八字軟體不能僅僅依賴於日期和時間輸入，它還必須要求精確的地理坐標（經度）3，這將計算任務從單純的時間查詢轉變為一項地質-時間的複合運算。

## ---

**IV. 時柱的進階算法：五鼠遁元法**

一旦確定了真太陽時對應的地支時辰（時支），下一步便是根據日柱的天干（日干），推導出時柱的天干（時干）。這一過程遵循「五鼠遁元法」（Five Rats Evasion Rule）。

### **IV.A. 五鼠遁元法的應用**

五鼠遁元法的核心目的，是為時柱確定其天干。它僅依賴於日柱的天干來確定子時的起始天干 5。

#### **IV.A.1. 傳統口訣與機制**

傳統的口訣，或稱「五鼠遁」日上起時法，是命理學經驗的總結 5。其口訣如下：

* **甲己還加甲**：凡日干是甲或己的日子，子時的天干從甲上起。  
* **乙庚丙作初**：凡日干是乙或庚的日子，子時的天干從丙上起。  
* **丙辛從戊起**：凡日干是丙或辛的日子，子時的天干從戊上起。  
* **丁壬庚子居**：凡日干是丁或壬的日子，子時的天干從庚上起。  
* **戊癸何方發，壬子是真途**：凡日干是戊或癸的日子，子時的天干從壬上起 5。

### **IV.B. 算法轉譯：查找矩陣與週期性**

在計算模型中，這套傳統口訣被高效地轉譯為一個查找矩陣。一旦確定了子時的天干，其餘十一個時辰的天干則依序以模數10的方式遞增，並對應十二地支（子、丑、寅、卯等）4。

#### **IV.B.1. 嵌套週期依賴性的結構分析**

時柱的計算是一個典型的嵌套模數系統。儘管時柱干支的完整週期為60，但其天干的起始點每12個時辰（一天）就會重置一次，而這個起始點的偏移量則由10個可能的日干決定。然而，根據五鼠遁元法的規則，日干是成對出現的（甲/己、乙/庚等），這將起始序列的數量從10組減少到僅有5組獨特的時干序列（$60 \\div 12 \= 5$）。這種底層的結構性關係，使得計算模型可以通過日干索引對5取模來高效地進行查表驗證。

五鼠遁元法 (Wǔ Shǔ Dùn Yuán Fǎ) 矩陣

| 日干 (Day Stem) | 日干索引 (mod 5\) | 子時 (Hour Stem) | 子時甲子循環 | 傳統口訣 |
| :---- | :---- | :---- | :---- | :---- |
| 甲, 己 | 1 | 甲 (Jia) | 甲子, 乙丑, 丙寅... | 甲己還加甲 |
| 乙, 庚 | 2 | 丙 (Bing) | 丙子, 丁丑, 戊寅... | 乙庚丙作初 |
| 丙, 辛 | 3 | 戊 (Wu) | 戊子, 己丑, 庚寅... | 丙辛從戊起 |
| 丁, 壬 | 4 | 庚 (Geng) | 庚子, 辛丑, 壬寅... | 丁壬庚子居 |
| 戊, 癸 | 0 / 5 | 壬 (Ren) | 壬子, 癸丑, 甲寅... | 戊癸何方發，壬子是真途 |

### **IV.C. 邊界條件的挑戰：日柱的切換點**

在八字計算中，存在一個關鍵的計時分歧點。雖然日柱的計算在現代程式中通常採用民用曆法定義（午夜00:00切換）來確定日柱索引 2，但時柱的推算卻將一天定義為從子時（本地真太陽時的23:00）開始 4。

這造成了一個重要的算法邊界條件挑戰：一個出生於真太陽時23:00:00之後的命例，其時柱是依據五鼠遁元法推算的，但有些傳統命理學派認為，子時的起始標誌著**新一天的日柱**的開始。因此，開發人員必須明確解決此一歧義：日柱應在午夜民用時間轉換，還是應在真太陽時的23:00轉換。最常見的計算解決方案是：固定日柱的索引 $I\_T$ 依據民用曆法邊界，而時柱的地支則依據真太陽時，允許兩者之間在午夜前後出現短暫的邏輯斷裂。

## ---

**V. 計算實現與開源專案分析**

本節分析當代軟體如何應對八字算法的計算需求，特別是針對時間校正和數據處理的複雜性。

### **V.A. 現有開源八字庫的檢視**

#### **V.A.1. bazica (Go 語言)**

該專案展示了處理當代時間問題的強大能力，利用標準庫功能如 time.LoadLocation 處理時區 6。其優勢在於能夠處理節氣數據和六十甲子週期。該專案特別強調了歷史時區的複雜性，例如胡志明市（西貢）在1975年前後，時區從UTC+8轉為UTC+7 6。這表明，精確的八字計算不僅需要經度校正，還必須納入歷史時區數據庫（如Zoneinfo/tz database）進行查核。

bazica 專案明確指出其日期輸入範圍限制在1900年1月1日至2100年12月31日 6。這個限制暗示了專案可能依賴於此範圍內標準化的天文曆表或近似值，而非適用於更廣泛歷史時期的通用天文模型。

#### **V.A.2. bazi-calculator-by-alvamind**

該專案重點在於「精確時間計算」以及對命主（Day Master）和五行結構的分析 7。該專案在其限制聲明中明確提到了「時區考量」和「農曆近似」是其需要處理的複雜性 7。這證實了在追求全球準確性時，歷史和地域差異所帶來的挑戰。

### **V.B. 處理時間複雜性的計算策略**

#### **V.B.1. 時區、夏令時與曆史時間數據庫**

現代計算模型必須納入協調世界時（UTC）、本地標準時間，以及夏令時（DST）的歷史應用。夏令時是純粹的民事/政治規定，與太陽位置無關。因此，在進行真太陽時計算之前，必須先將夏令時的偏移完全還原，確保計算基礎是標準時間。

對於歷史日期，計算的準確性必須建立在正確的**歷史時區**基礎上。例如，如果某地區在歷史上改變了其官方時區（例如從UTC+8變為UTC+7），則基於當前時區的經度校正將對歷史日期產生系統性錯誤。因此，八字軟體需要先查核特定日期和地點的歷史時區，然後根據該歷史時區的標準經線來進行真太陽時的校正 6。

#### **V.B.2. 日期範圍與計算複雜度的權衡**

許多開源專案將日期範圍限制在1900年至2100年 6，這反映了計算模型在數據量和精度之間所做的實際權衡。在1900年之前，公曆規則、標準時區的建立和天文觀測的精確度都較為複雜。要計算1900年之前的八字，軟體必須整合大規模、高精度、處理曆史曆法改革的天文曆表數據（例如 VSOP87 或 DE430），這將極大地增加項目的計算負載和數據依賴性。因此，常見的日期限制是為了在可接受的計算資源內提供合理的準確性。

Comparative Analysis of Identified Open Source Bazi Projects

| 專案名稱/庫 | 語言/平台 | 關鍵算法重點 | 時區/DST 處理 | 日期範圍支持 |
| :---- | :---- | :---- | :---- | :---- |
| bazica (tommitoan) 6 | Go | 節氣、六十甲子、完整圖表 | 明確使用 time.LoadLocation；註記歷史時區變化 (如越南) | 1900 至 2100 |
| bazi-calculator (alvamind) 7 | 未指明 | 精確時間計算、命主/五行分析 | 明確將時區考量列為限制/重點領域 | 不確定 (Varies) |
| **通用模型 (理想)** | 語言中立 | JD/MJD 整合、高精度 EOT、五鼠遁元法 | 依賴 IANA tz 數據庫處理歷史時區 | 理論上無限 (要求整合天文曆表) |

## ---

**VI. 結論與未來研究方向**

日柱與時柱的計算構成了八字排盤算法的核心。日柱的推算是一個相對線性且穩定的數學問題，其核心在於連續日計數（Julian Day等）和模數60運算 2。相比之下，時柱的計算則是一個複雜的兩階段過程：首先需要通過嚴格的地理時間校正（經度校正與均時差EOT）確定真太陽時，精確劃分地支時辰；隨後再應用固定的查找規則——五鼠遁元法——來確定時干 3。

### **VI.A. 計算瓶頸的總結**

現代計算模型必須成功處理三個層次的時間複雜性：

1. **天文曆表層次：** 確保年柱和月柱的起始點（節氣）精確無誤 1。  
2. **線性計數層次：** 確保日柱的連續索引 ($I\_T$) 在跨越百年週期時，能準確計算閏年和曆法改革的影響 2。  
3. **地理時間校正層次：** 這是時柱的核心挑戰。軟體必須處理歷史時區、夏令時還原，以及納入均時差（EOT）以滿足真太陽時的定義 3。

### **VI.B. 對開源專案的建議**

鑑於目前開源專案通常存在1900年至2100年的日期限制 6，未來發展應著重於整合更廣泛範圍的歷史天文曆表數據，以擴展計算的適用期。此外，計算模型應標準化對「子時換日」邊界條件的處理方式。目前業界普遍採用民用曆法定義日柱，但若能程式化地統一在真太陽時23:00切換日柱的定義，將有助於確保軟體在不同計算平臺和傳統命理學派之間的一致性。這些改進將使得八字排盤算法在計量學上更加嚴謹和普適。

#### **引用的著作**

1. 八字流月所用的曆法, 檢索日期：12月 4, 2025， [https://vocus.cc/article/659772fefd89780001f8d26d](https://vocus.cc/article/659772fefd89780001f8d26d)  
2. 干支記時法的數學分析, 檢索日期：12月 4, 2025， [https://www.math.sinica.edu.tw/media/pdf/d444/44413.pdf](https://www.math.sinica.edu.tw/media/pdf/d444/44413.pdf)  
3. 真太阳时和八字计算 \- 北京时间- 日历, 檢索日期：12月 4, 2025， [http://time.org.cn/bazi.htm](http://time.org.cn/bazi.htm)  
4. 五鼠遁口诀 \- 新浪, 檢索日期：12月 4, 2025， [https://k.sina.cn/article\_6926146829\_19cd49d0d00100wies.html](https://k.sina.cn/article_6926146829_19cd49d0d00100wies.html)  
5. 五虎遁月和五鼠遁时法- 日记- 豆瓣, 檢索日期：12月 4, 2025， [https://m.douban.com/note/253233436/](https://m.douban.com/note/253233436/)  
6. tommitoan/bazica: Ba-zi Calculator: Convert Solar Calendar to Bazi Chart (Chinese astrology) \- GitHub, 檢索日期：12月 4, 2025， [https://github.com/tommitoan/bazica](https://github.com/tommitoan/bazica)  
7. Bazi Calculator by Alvamind 八字计算器 \- GitHub, 檢索日期：12月 4, 2025， [https://github.com/alvamind/bazi-calculator-by-alvamind](https://github.com/alvamind/bazi-calculator-by-alvamind)