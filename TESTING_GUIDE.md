# 測試指南

## 紫微斗數計算功能測試

### 前端測試

- 使用 Vitest 撰寫組件單元測試
- 測試內容包括：
  - 表單輸入驗證（必填欄位、格式限制）
  - API 調用模擬與錯誤處理
  - 命盤結果的正確渲染與互動
- 範例檔案：`src/components/__tests__/ZiweiCalculator.spec.ts`

### 後端測試

- 使用 Jest + Supertest 撰寫 API 端點測試
- 測試內容包括：
  - 請求參數驗證（缺失或格式錯誤）
  - 正確回應格式與資料結構
  - 錯誤處理與異常狀況
- 範例檔案：`src/__tests__/routes/purpleStarRoutes.spec.ts`

## 八字計算功能測試

### 前端測試

- 使用 Vitest 測試八字計算邏輯
- 測試內容包括：
  - baziCalc.ts 中的計算函數準確性
  - lunar.min.js 整合功能
  - 各種日期時間輸入的處理
- 範例檔案：`src/utils/__tests__/baziCalc.spec.ts`

### 組件測試

- 測試 BaziInputForm 和 BaziChartDisplay 組件
- 重點測試：
  - 表單驗證邏輯
  - 資料流傳遞
  - 正確渲染計算結果
  - 語言切換效果
- 範例檔案：`src/components/__tests__/BaziChart.spec.ts`

## 資料傳遞問題測試

### API 調用測試

- 使用 Mock 服務測試 apiService 中的方法
- 重點測試：
  - 請求頭設置正確性
  - 日期時間格式轉換
  - 錯誤處理邏輯
- 測試場景：
  - 正常請求
  - 不完整資料
  - 伺服器錯誤

### 網絡請求測試

- 使用 Cypress 或類似工具進行端到端測試
- 測試內容：
  - 表單提交流程
  - 加載狀態顯示
  - 錯誤提示機制
  - 結果渲染

## 國際化（i18n）測試

### 翻譯鍵測試

- 確保所有界面文本都使用翻譯鍵
- 檢查翻譯鍵是否存在於所有語言文件中
- 使用自動化工具識別缺失的翻譯

### 語言切換測試

- 測試動態語言切換功能
- 驗證所有組件在語言切換後正確更新
- 檢查特殊格式（日期、數字）的本地化

## 測試執行指令

```bash
# 前端測試
cd bazi-app-vue
npm run test

# 後端測試
cd backend-node
npm run test
```

### 測試覆蓋率

- 建議前後端測試覆蓋率均達 80% 以上
- 使用覆蓋率報告檢視未覆蓋的程式碼區塊

### 測試最佳實踐

- 使用模擬資料與假物件（mock）隔離測試範圍
- 持續整合 (CI) 中自動執行測試
- 定期更新測試案例，涵蓋新功能與修正

## 回歸測試清單

在進行重大修改或修復後，請執行以下回歸測試：

1. **八字計算功能**
   - 輸入各種出生資料，檢查計算結果
   - 確認十神、大運、流年等計算正確
   - 測試不同語言環境下的顯示

2. **紫微斗數功能**
   - 檢查命盤排盤結果
   - 驗證宮位與星曜顯示
   - 測試資料傳遞到後端 API

3. **多術數交互驗證**
   - 同時生成八字和紫微斗數結果
   - 檢查交叉分析功能
   - 驗證信心度評分

4. **用戶界面**
   - 測試各個頁面的導航
   - 檢查響應式設計在不同設備上的表現
   - 驗證表單驗證和錯誤提示

---

此測試指南將隨著專案發展持續更新。若有特定功能需要專門的測試策略，請在相應的子目錄下創建詳細的測試文檔。
