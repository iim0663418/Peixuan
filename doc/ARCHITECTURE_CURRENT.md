# ç•¶å‰æ¶æ§‹ç‹€æ…‹ (2025-11-29)

## å‰å¾Œç«¯è·è²¬åŠƒåˆ†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å‰ç«¯ (Vue 3 PWA)                      â”‚
â”‚                 bazi-app-vue/src/                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  ğŸ“Š å…«å­—è¨ˆç®— (æœ¬åœ°)                                      â”‚
â”‚  â”œâ”€ baziCalc.ts (1,146 lines)                           â”‚
â”‚  â”œâ”€ BaziCalculator.calculateBazi()                      â”‚
â”‚  â””â”€ âœ… ä½¿ç”¨ä¸­: BaziView.vue, UserInputForm.vue          â”‚
â”‚                                                          â”‚
â”‚  âš ï¸ ç´«å¾®æ–—æ•¸è¨ˆç®— (æœªä½¿ç”¨)                                â”‚
â”‚  â”œâ”€ ziweiCalc.ts (683 lines)                            â”‚
â”‚  â”œâ”€ PurpleStarCalculator.generateChart()                â”‚
â”‚  â””â”€ âŒ ç„¡å¼•ç”¨ï¼Œåƒ…æ¸¬è©¦ä½¿ç”¨                                â”‚
â”‚                                                          â”‚
â”‚  ğŸŒ API å‘¼å«                                             â”‚
â”‚  â”œâ”€ apiService.calculatePurpleStar()                    â”‚
â”‚  â””â”€ POST /api/v1/purple-star/calculate                  â”‚
â”‚                                                          â”‚
â”‚  ğŸ¨ UI çµ„ä»¶                                              â”‚
â”‚  â”œâ”€ BaziView.vue, PurpleStarView.vue                    â”‚
â”‚  â”œâ”€ BaziChartDisplay, PurpleStarChartDisplay            â”‚
â”‚  â””â”€ å„ç¨®è¼¸å…¥è¡¨å–®èˆ‡é¡¯ç¤ºçµ„ä»¶                               â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ HTTPS
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              å¾Œç«¯ (Cloudflare Workers)                   â”‚
â”‚              peixuan-worker/src/                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  âŒ å…«å­—è¨ˆç®— - ç„¡å¯¦ç¾                                    â”‚
â”‚                                                          â”‚
â”‚  âœ… ç´«å¾®æ–—æ•¸è¨ˆç®—                                         â”‚
â”‚  â”œâ”€ purpleStarCalculation.ts (681 lines)                â”‚
â”‚  â”œâ”€ PurpleStarController.calculate()                    â”‚
â”‚  â””â”€ POST /api/v1/purple-star/calculate                  â”‚
â”‚                                                          â”‚
â”‚  ğŸ’¾ è³‡æ–™æŒä¹…åŒ–                                           â”‚
â”‚  â”œâ”€ chartController (å‘½ç›¤ CRUD)                          â”‚
â”‚  â”œâ”€ analysisController (åˆ†æ CRUD)                       â”‚
â”‚  â”œâ”€ D1 Database (SQLite)                                â”‚
â”‚  â””â”€ Drizzle ORM                                          â”‚
â”‚                                                          â”‚
â”‚  âš¡ å¿«å– (å¯é¸)                                          â”‚
â”‚  â””â”€ KV Namespace                                         â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## API ç«¯é»æ¸…å–®

### âœ… å·²å¯¦ç¾

| ç«¯é» | æ–¹æ³• | åŠŸèƒ½ | æ§åˆ¶å™¨ |
|------|------|------|--------|
| `/health` | GET | å¥åº·æª¢æŸ¥ | - |
| `/api/charts` | GET | å‘½ç›¤æ­·å² | chartController |
| `/api/charts` | POST | ä¿å­˜å‘½ç›¤ | chartController |
| `/api/charts/:id` | GET | å–®ä¸€å‘½ç›¤ | chartController |
| `/api/analyses` | GET | åˆ†ææ­·å² | chartController |
| `/api/analyses` | POST | ä¿å­˜åˆ†æ | chartController |
| `/api/v1/purple-star/calculate` | POST | ç´«å¾®æ–—æ•¸è¨ˆç®— | purpleStarController |

### âŒ æœªå¯¦ç¾ï¼ˆå‰ç«¯æœŸæœ›ï¼‰

| ç«¯é» | æ–¹æ³• | åŠŸèƒ½ | ç‹€æ…‹ |
|------|------|------|------|
| `/api/v1/bazi/calculate` | POST | å…«å­—è¨ˆç®— | ç„¡éœ€æ±‚ï¼ˆå‰ç«¯è¨ˆç®—ï¼‰ |
| `/api/v1/astrology/integrated-analysis` | POST | æ•´åˆåˆ†æ | æœªå¯¦ç¾ |
| `/api/v1/astrology/confidence-assessment` | POST | ä¿¡å¿ƒåº¦è©•ä¼° | æœªå¯¦ç¾ |

## ä»£ç¢¼é‡è¤‡å•é¡Œ

### ç´«å¾®æ–—æ•¸è¨ˆç®—é‚è¼¯

```
å‰ç«¯: bazi-app-vue/src/utils/ziweiCalc.ts
      â”œâ”€ 683 lines
      â”œâ”€ âŒ ç„¡ä»»ä½•å¼•ç”¨
      â””â”€ âœ… åƒ…æ¸¬è©¦ä½¿ç”¨

å¾Œç«¯: peixuan-worker/src/services/purpleStarCalculation.ts
      â”œâ”€ 681 lines
      â”œâ”€ âœ… ä½¿ç”¨ä¸­
      â””â”€ å¾å‰ç«¯è¤‡è£½ä¸¦ä¿®æ”¹
```

**å·®ç•°**:
- Import: å…¨å±€ `Solar/Lunar` â†’ `lunar-typescript`
- ç§»é™¤: `console.log`
- ä¿®å¾©: ä¸­æ–‡æ•¸å­—æ”¯æ´

## ä¾è³´é …

### å‰ç«¯
- `lunar-javascript` (å…¨å±€è…³æœ¬)
- Vue 3, Pinia, Vue Router, Axios, Element Plus

### å¾Œç«¯
- `lunar-typescript` (npm åŒ…)
- Drizzle ORM, @cloudflare/kv-asset-handler

## å»ºè­°å„ªåŒ–

### ğŸ”´ é«˜å„ªå…ˆç´š
1. **ç§»é™¤å‰ç«¯ ziweiCalc.ts**ï¼ˆæœªä½¿ç”¨ï¼Œä»£ç¢¼é‡è¤‡ï¼‰
2. **æ›´æ–° README.md**ï¼ˆbackend-node â†’ peixuan-workerï¼‰

### ğŸŸ¡ ä¸­å„ªå…ˆç´š
3. **å»ºç«‹ ARCHITECTURE.md**ï¼ˆæ¶æ§‹æ–‡æª”ï¼‰
4. **å¯¦ç¾ç¼ºå¤±åŠŸèƒ½**ï¼ˆå››åŒ–é£›æ˜Ÿå½™ç¸½ã€æµå¹´å¤ªæ­²ï¼‰

### ğŸŸ¢ ä½å„ªå…ˆç´š
5. **æå–ç‚ºå…±äº« npm åŒ…**ï¼ˆé•·æœŸå„ªåŒ–ï¼‰
6. **å¯¦ç¾å…«å­—å¾Œç«¯ API**ï¼ˆå¯é¸ï¼‰

---

**æœ€å¾Œæ›´æ–°**: 2025-11-29  
**ç‹€æ…‹**: åŠŸèƒ½å®Œæ•´ï¼Œéœ€å„ªåŒ–ä»£ç¢¼é‡è¤‡
