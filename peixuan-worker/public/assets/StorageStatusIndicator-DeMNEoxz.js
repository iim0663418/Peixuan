import{d as F,i as P,r as f,j as w,h as V,T as n,E as i,$ as j,_ as N,g as G,c as k,o as b,a,b as B,t,n as K,f as D,w as y,e as $}from"./index-BkKrQnZY.js";const L=F({name:"StorageStatusIndicator",setup(){const{t:e}=P(),l=f(null),c=f(!0),d=f(!1),r=f(null),g=f(null),u=s=>{if(s===0)return"0 Bytes";const o=1024,C=["Bytes","KB","MB","GB"],v=Math.floor(Math.log(s)/Math.log(o));return parseFloat((s/Math.pow(o,v)).toFixed(2))+" "+C[v]},h=s=>s.toFixed(2)+"%",p=s=>s?new Date(s).toLocaleString():e("storage.never"),m=w(()=>!c.value||r.value==="error"?"status-error":r.value==="warning"||l.value&&l.value.usagePercentage>80?"status-warning":"status-ok"),_=w(()=>c.value?r.value==="error"||r.value==="warning"||l.value&&l.value.usagePercentage>80?"⚠️":"✅":"❌"),E=w(()=>c.value?r.value==="error"?e("storage.dataInconsistent"):r.value==="warning"?e("storage.dataWarning"):l.value&&l.value.usagePercentage>80?e("storage.almostFull"):e("storage.healthy"):e("storage.unavailable")),S=()=>{c.value=n.isStorageAvailable(),c.value&&(l.value=n.getStorageUsage())},M=()=>{d.value=!d.value,d.value&&S()},T=async()=>{try{n.clearChartData(),i.success(e("storage.dataCleared")),S()}catch(s){console.error("清除資料時發生錯誤:",s),i.error(e("storage.clearError"))}},z=()=>{try{n.initializeStorage();const s=n.validateStorageData(),o=j("peixuan_storage_warnings");if(g.value=n.getUnifiedSessionData(),s&&!o)r.value="success",i.success(e("storage.validationSuccess"));else if(s&&o){r.value="warning";let C=(o==null?void 0:o.message)||e("storage.validationWarning");if(o!=null&&o.details){const v=Object.entries(o.details).map(([A,I])=>`${A}: ${I.join(", ")}`).join("; ");C+=`
${e("storage.missingFields")}: ${v}`}i({message:C,type:"warning",duration:5e3}),o.details&&n.syncChartsToUnifiedData()&&console.log("自動嘗試修復資料不一致")}else r.value="error",i.error(e("storage.validationError"))}catch(s){console.error("驗證資料時發生錯誤:",s),r.value="error",i.error(e("storage.validationError"))}S()},U=()=>{try{n.syncChartsToUnifiedData()?(g.value=n.getUnifiedSessionData(),i.success(e("storage.syncSuccess")),z()):i.error(e("storage.syncError"))}catch(s){console.error("同步圖表資料時發生錯誤:",s),i.error(e("storage.syncError"))}};return V(()=>{S(),g.value=n.getUnifiedSessionData()}),{storageStats:l,storageAvailable:c,showDetails:d,validationStatus:r,unifiedData:g,statusClass:m,statusIcon:_,statusText:E,formatSize:u,formatPercentage:h,formatTime:p,toggleDetails:M,clearAllData:T,validateData:z,syncAllCharts:U}}}),O={class:"storage-status"},q={class:"status-icon"},H={class:"status-text"},J={key:0,class:"unified-data-badge"},Q={class:"label"},R={key:1,class:"storage-details"},X={class:"detail-item"},Y={class:"label"},Z={class:"value"},W={class:"detail-item"},x={class:"label"},ee={class:"value"},se={class:"detail-item"},ae={class:"label"},te={class:"value"},oe={class:"detail-item"},re={class:"label"},ne={class:"value"},le={class:"storage-actions"};function ie(e,l,c,d,r,g){var h,p,m,_;const u=G("el-button");return b(),k("div",O,[a("div",{class:K(["status-badge",e.statusClass])},[a("span",q,t(e.statusIcon),1),a("span",H,t(e.statusText),1)],2),e.unifiedData?(b(),k("div",J,[a("span",Q,t(e.$t("storage.unifiedData")),1)])):B("",!0),e.showDetails?(b(),k("div",R,[a("div",X,[a("span",Y,t(e.$t("storage.totalSize"))+":",1),a("span",Z,t(e.formatSize(((h=e.storageStats)==null?void 0:h.totalSize)||0)),1)]),a("div",W,[a("span",x,t(e.$t("storage.usage"))+":",1),a("span",ee,t(e.formatPercentage(((p=e.storageStats)==null?void 0:p.usagePercentage)||0)),1)]),a("div",se,[a("span",ae,t(e.$t("storage.itemCount"))+":",1),a("span",te,t(((m=e.storageStats)==null?void 0:m.itemCount)||0),1)]),a("div",oe,[a("span",re,t(e.$t("storage.lastUpdated"))+":",1),a("span",ne,t(e.formatTime((_=e.storageStats)==null?void 0:_.lastUpdated)),1)])])):B("",!0),a("div",le,[D(u,{size:"small",type:"info",onClick:e.toggleDetails},{default:y(()=>[$(t(e.showDetails?e.$t("storage.hideDetails"):e.$t("storage.showDetails")),1)]),_:1},8,["onClick"]),D(u,{size:"small",type:"danger",onClick:e.clearAllData},{default:y(()=>[$(t(e.$t("storage.clearAll")),1)]),_:1},8,["onClick"]),D(u,{size:"small",type:"success",onClick:e.validateData},{default:y(()=>[$(t(e.$t("storage.validate")),1)]),_:1},8,["onClick"]),D(u,{size:"small",type:"primary",onClick:e.syncAllCharts},{default:y(()=>[$(t(e.$t("storage.sync")),1)]),_:1},8,["onClick"])])])}const ue=N(L,[["render",ie],["__scopeId","data-v-f329819e"]]);export{ue as S};
