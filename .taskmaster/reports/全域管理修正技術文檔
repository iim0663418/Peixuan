全域狀態管理技術文檔
1. 設計思路
以 App.vue 作為全域狀態管理的中心，統一管理模組選擇（activeModule）與顯示深度（moduleDepths）等狀態。
使用 Vue 3 的 provide/inject 機制，將狀態與方法注入子元件，實現父子組件間的狀態共享。
子元件（如 GlobalDisplayModePanel.vue）透過 props 接收狀態，並使用 emit 事件回傳狀態變更請求。
跨組件同步輔助使用 window 自訂事件（如 display-depth-changed）以通知非父子關係的元件。
狀態持久化使用 sessionStorage，在 App.vue 初始化時讀取並同步狀態，確保頁面刷新或切換時狀態保持一致。
2. 核心狀態與方法
activeModule: string — 當前選中的模組（如紫微斗數、八字命盤等）。
moduleDepths: Record<string, string> — 各模組對應的顯示深度設定。
setActiveModule(module: string) — 設置當前模組，並同步更新狀態與持久化。
setDisplayDepth(module: string, depth: string) — 設置指定模組的顯示深度，並同步更新狀態與持久化。
3. 子元件接口規範
props：
activeModule: string
moduleDepths: Record<string, string>
emit 事件：
update:activeModule — 請求更新當前模組。
update:moduleDepths — 請求更新模組深度。
子元件不直接管理狀態，所有狀態變更均透過事件通知父元件。
4. 跨元件同步策略
父子組件使用 provide/inject 共享狀態與方法。
非父子組件透過監聽 window 自訂事件同步狀態。
事件名稱統一管理，避免重複或衝突。
狀態變更時，父元件負責派發事件通知其他元件。
5. 持久化方案
使用 sessionStorage 保存 activeModule 與 moduleDepths。
頁面載入時，從 sessionStorage 讀取並初始化狀態。
狀態變更時，同步更新 sessionStorage。
6. 使用者測試指引
測試全域面板操作，確認模組切換與顯示深度調整能同步更新。
測試各頁面（如紫微斗數頁面）狀態與全域面板同步。
測試整合分析模組自動切換與狀態同步。
測試頁面刷新與切換，確認狀態持久化正常。
