# ä½©ç’‡é€²éšåˆ†æåŠŸèƒ½ - é‡æ–°å¯¦ä½œè¨ˆåŠƒ

**æ–‡æª”ç‰ˆæœ¬**: v2.0  
**å‰µå»ºæ—¥æœŸ**: 2025-12-04  
**ç‹€æ…‹**: è¦åŠƒä¸­

---

## ğŸ“‹ åŸ·è¡Œæ‘˜è¦

æœ¬æ–‡æª”è¦åŠƒä½©ç’‡é€²éšåˆ†æåŠŸèƒ½çš„é‡æ–°å¯¦ä½œï¼Œå¸å–ä¹‹å‰ç›´æ¥åœ¨ç”Ÿç”¢ç’°å¢ƒæ¸¬è©¦çš„æ•™è¨“ï¼Œæ¡ç”¨æ›´å®‰å…¨ã€æ›´ç³»çµ±åŒ–çš„é–‹ç™¼æµç¨‹ã€‚

### æ ¸å¿ƒåŸå‰‡
1. **æœ¬åœ°å„ªå…ˆ**: æ‰€æœ‰é–‹ç™¼å’Œæ¸¬è©¦åœ¨æœ¬åœ°ç’°å¢ƒå®Œæˆ
2. **å°æ­¥è¿­ä»£**: æ¯å€‹åŠŸèƒ½é»ç¨ç«‹é–‹ç™¼ã€æ¸¬è©¦ã€æäº¤
3. **ç’°å¢ƒéš”é›¢**: åš´æ ¼å€åˆ†é–‹ç™¼/æ¸¬è©¦/ç”Ÿç”¢ç’°å¢ƒ
4. **ä»£ç¢¼å¯©æŸ¥**: æ‰€æœ‰ä»£ç¢¼é€šé PR å¯©æŸ¥å¾Œæ‰åˆä½µ
5. **è‡ªå‹•åŒ–æ¸¬è©¦**: å¯¦ä½œå–®å…ƒæ¸¬è©¦å’Œæ•´åˆæ¸¬è©¦

---

## ğŸ¯ èƒŒæ™¯èˆ‡æ•™è¨“

### ä¹‹å‰çš„å•é¡Œ
1. âŒ ç›´æ¥åœ¨ç”Ÿç”¢ç’°å¢ƒæ¸¬è©¦æ–°åŠŸèƒ½
2. âŒ æœªæäº¤ä»£ç¢¼åˆ° Gitï¼Œå°è‡´ä»£ç¢¼ä¸Ÿå¤±
3. âŒ æ·»åŠ äº†æ¸¬è©¦ç«¯é»åˆ°ç”Ÿç”¢ç’°å¢ƒ
4. âŒ æœªå……åˆ†æ¸¬è©¦ Gemini API é…é¡é™åˆ¶
5. âŒ ç¼ºä¹æœ¬åœ°é–‹ç™¼ç’°å¢ƒ

### æ”¹é€²æªæ–½
1. âœ… ä½¿ç”¨ `wrangler dev` æœ¬åœ°é–‹ç™¼
2. âœ… æ¯å€‹åŠŸèƒ½é»éƒ½æäº¤åˆ° Git
3. âœ… æ¸¬è©¦ç«¯é»åƒ…åœ¨é–‹ç™¼ç’°å¢ƒ
4. âœ… å¯¦ä½œ API é…é¡ç›£æ§å’Œé™ç´šç­–ç•¥
5. âœ… å»ºç«‹å®Œæ•´çš„æ¸¬è©¦æµç¨‹

---

## ğŸ¯ ç›®æ¨™èˆ‡ç¯„åœ

### åŠŸèƒ½ç›®æ¨™
æä¾›é€²éšå‘½ç†åˆ†æï¼ŒåŒ…å«ï¼š
1. **æ·±å±¤æ€§æ ¼åˆ†æ**: åŸºæ–¼åç¥çŸ©é™£å’Œè—å¹²ç³»çµ±
2. **èƒ½é‡æµå‹•åˆ†æ**: å››åŒ–é£›æ˜Ÿå¾ªç’°å’Œä¸­å¿ƒæ€§
3. **èƒ½é‡å¹³è¡¡åˆ†æ**: æ˜Ÿæ›œå°ç¨±æ€§
4. **æœªä¾†é æ¸¬**: ä¸‹ä¸€å¹´è¶¨å‹¢ã€é¢¨éšªè©•ä¼°
5. **è¡Œå‹•æŒ‡å—**: å­£åº¦å®œå¿Œå»ºè­°

### æŠ€è¡“ç›®æ¨™
1. å®Œæ•´çš„æœ¬åœ°é–‹ç™¼ç’°å¢ƒ
2. å–®å…ƒæ¸¬è©¦è¦†è“‹ç‡ > 80%
3. API éŸ¿æ‡‰æ™‚é–“ < 30s
4. å¿«å–å‘½ä¸­ç‡ > 70%
5. éŒ¯èª¤è™•ç†å’Œé™ç´šç­–ç•¥

### éç›®æ¨™ï¼ˆæœ¬æ¬¡ä¸åšï¼‰
1. âŒ å¤šèªè¨€æ”¯æ´ï¼ˆåƒ…ä¸­æ–‡ï¼‰
2. âŒ ä»˜è²»åŠŸèƒ½ï¼ˆæš«æ™‚å…è²»ï¼‰
3. âŒ è¤‡é›œçš„æ¬Šé™æ§åˆ¶
4. âŒ æ­·å²åˆ†æè¨˜éŒ„

---

## ğŸ—ï¸ æ¶æ§‹è¨­è¨ˆ

### ç³»çµ±æ¶æ§‹
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Frontend (Vue 3)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  AdvancedAnalysisView.vue                        â”‚  â”‚
â”‚  â”‚  - SSE EventSource                               â”‚  â”‚
â”‚  â”‚  - Markdown Rendering                            â”‚  â”‚
â”‚  â”‚  - Loading States                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“ HTTPS
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Cloudflare Workers (API Layer)              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  GET /api/v1/analyze/advanced/check              â”‚  â”‚
â”‚  â”‚  GET /api/v1/analyze/advanced/stream             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                            â†“                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  AnalyzeController                               â”‚  â”‚
â”‚  â”‚  - analyzeAdvancedStream()                       â”‚  â”‚
â”‚  â”‚  - checkAdvancedCache()                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                            â†“                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Business Logic Layer                            â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚ formatAdvancedMarkdown()                   â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ - TenGods Matrix                           â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ - Hidden Stems                             â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ - SiHua Aggregation                        â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ - Star Symmetry                            â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ - Next Year Prediction                     â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚ calculateNextYear()                        â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ - Tai Sui Detection                        â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ - Risk Assessment                          â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ - Quarterly Action Plan                    â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                            â†“                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  External Services                               â”‚  â”‚
â”‚  â”‚  - GeminiService (AI Analysis)                   â”‚  â”‚
â”‚  â”‚  - AdvancedAnalysisCacheService (D1)             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Cloudflare D1 (SQLite)                 â”‚
â”‚  - advanced_analysis_records (24h TTL)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•¸æ“šæµ
1. **é¦–æ¬¡è«‹æ±‚**: Frontend â†’ API â†’ formatMarkdown â†’ Gemini â†’ SSE â†’ Cache â†’ Frontend
2. **å¿«å–å‘½ä¸­**: Frontend â†’ API â†’ Cache â†’ SSE â†’ Frontend

---

## ğŸ”„ è¿­ä»£è¨ˆåŠƒ

### Iteration 1: æ•¸æ“šå±¤ (2-3h)
**ç›®æ¨™**: å»ºç«‹ D1 Schema å’Œ Cache Service

**ä»»å‹™**:
1. å‰µå»º D1 migration (`0002_add_advanced_analysis.sql`)
   ```sql
   CREATE TABLE advanced_analysis_records (
     id TEXT PRIMARY KEY,
     chart_id TEXT NOT NULL,
     result TEXT NOT NULL,
     created_at TEXT DEFAULT (datetime('now')),
     FOREIGN KEY (chart_id) REFERENCES chart_records(id) ON DELETE CASCADE
   );
   CREATE INDEX idx_advanced_analysis_chart_id ON advanced_analysis_records(chart_id);
   CREATE INDEX idx_advanced_analysis_created_at ON advanced_analysis_records(created_at);
   ```

2. å¯¦ä½œ `AdvancedAnalysisCacheService`
   - `getAnalysis(chartId, env)`: æŸ¥è©¢å¿«å–ï¼ˆ24h TTLï¼‰
   - `saveAnalysis(chartId, result, env)`: ä¿å­˜å¿«å–

3. æœ¬åœ°æ¸¬è©¦
   ```bash
   wrangler d1 migrations apply peixuan-db --local
   ```

4. æäº¤åˆ° Git
   ```bash
   git add peixuan-worker/drizzle/0002_add_advanced_analysis.sql
   git add peixuan-worker/src/services/advancedAnalysisCacheService.ts
   git commit -m "feat: add advanced analysis D1 schema and cache service"
   ```

**é©—æ”¶æ¨™æº–**:
- âœ… Migration åœ¨æœ¬åœ° D1 åŸ·è¡ŒæˆåŠŸ
- âœ… Cache Service å–®å…ƒæ¸¬è©¦é€šé
- âœ… ä»£ç¢¼å·²æäº¤åˆ° Git

---

### Iteration 2: æ¥­å‹™é‚è¼¯å±¤ (4-6h)
**ç›®æ¨™**: å¯¦ä½œ Markdown Formatter å’Œ Next Year Calculator

**ä»»å‹™**:
1. å¯¦ä½œ `nextYearCalculator.ts`
   - `calculateNextYear(birthInfo, currentYear)`: è¨ˆç®—ä¸‹ä¸€å¹´é‹å‹¢
   - Tai Sui é¡å‹æª¢æ¸¬ï¼ˆå€¼/æ²–/åˆ‘/ç ´/å®³ï¼‰
   - é¢¨éšªè©•ä¼°ï¼ˆå¥åº·/è²¡å¯Œ/äº‹æ¥­/é—œä¿‚ï¼‰
   - å­£åº¦è¡Œå‹•è¨ˆç•«ï¼ˆQ1-Q4 å®œå¿Œï¼‰

2. å¯¦ä½œ `advancedMarkdownFormatter.ts`
   - `formatAdvancedMarkdown(result)`: ç”Ÿæˆé€²éš Markdown
   - 5 å€‹å€å¡Šï¼šåç¥çŸ©é™£ã€è—å¹²ç³»çµ±ã€å››åŒ–é£›æ˜Ÿã€æ˜Ÿæ›œå°ç¨±ã€ä¸‹ä¸€å¹´é æ¸¬
   - ç›®æ¨™é•·åº¦ï¼š~200 tokens

3. å–®å…ƒæ¸¬è©¦
   ```typescript
   // nextYearCalculator.test.ts
   describe('calculateNextYear', () => {
     it('should detect Tai Sui types', () => {
       // æ¸¬è©¦æ¡ˆä¾‹
     });
     it('should assess risks', () => {
       // æ¸¬è©¦æ¡ˆä¾‹
     });
   });
   ```

4. æœ¬åœ°æ¸¬è©¦
   ```bash
   npm test -- nextYearCalculator.test.ts
   npm test -- advancedMarkdownFormatter.test.ts
   ```

5. æäº¤åˆ° Git
   ```bash
   git add peixuan-worker/src/calculation/annual/nextYearCalculator.ts
   git add peixuan-worker/src/formatters/advancedMarkdownFormatter.ts
   git add peixuan-worker/src/__tests__/
   git commit -m "feat: add next year calculator and advanced markdown formatter"
   ```

**é©—æ”¶æ¨™æº–**:
- âœ… å–®å…ƒæ¸¬è©¦è¦†è“‹ç‡ > 80%
- âœ… Markdown è¼¸å‡ºæ ¼å¼æ­£ç¢º
- âœ… Date è½‰æ›å•é¡Œå·²ä¿®å¾©
- âœ… ä»£ç¢¼å·²æäº¤åˆ° Git

---

### Iteration 3: API å±¤ (2-3h)
**ç›®æ¨™**: å¯¦ä½œ Controller å’Œ Routes

**ä»»å‹™**:
1. æ›´æ–° `AnalyzeController`
   - `analyzeAdvancedStream(chartId, env)`: é€²éšåˆ†æ SSE
   - `checkAdvancedCache(chartId, env)`: å¿«å–æª¢æŸ¥
   - `transformAdvancedToSSE()`: SSE è½‰æ›

2. æ›´æ–° `analyzeRoutes.ts`
   - `GET /api/v1/analyze/advanced/check`: å¿«å–æª¢æŸ¥ç«¯é»
   - `GET /api/v1/analyze/advanced/stream`: SSE streaming ç«¯é»

3. æ›´æ–° `GeminiService`
   - `analyzeAdvancedStream(markdown)`: Gemini streaming
   - `buildAdvancedPrompt(markdown)`: é€²éš promptï¼ˆ~250 tokensï¼‰

4. æœ¬åœ°æ¸¬è©¦
   ```bash
   wrangler dev
   # æ¸¬è©¦ç«¯é»
   curl http://localhost:8787/api/v1/analyze/advanced/check?chartId=xxx
   curl -N http://localhost:8787/api/v1/analyze/advanced/stream?chartId=xxx
   ```

5. æäº¤åˆ° Git
   ```bash
   git add peixuan-worker/src/controllers/analyzeController.ts
   git add peixuan-worker/src/routes/analyzeRoutes.ts
   git add peixuan-worker/src/services/geminiService.ts
   git commit -m "feat: add advanced analysis API endpoints"
   ```

**é©—æ”¶æ¨™æº–**:
- âœ… æœ¬åœ°ç«¯é»æ¸¬è©¦é€šé
- âœ… SSE streaming æ­£å¸¸å·¥ä½œ
- âœ… å¿«å–æ©Ÿåˆ¶æ­£å¸¸
- âœ… ä»£ç¢¼å·²æäº¤åˆ° Git

---

### Iteration 4: å‰ç«¯å±¤ (2-3h)
**ç›®æ¨™**: å¯¦ä½œå‰ç«¯è¦–åœ–å’Œè·¯ç”±

**ä»»å‹™**:
1. å‰µå»º `AdvancedAnalysisView.vue`
   - è¤‡è£½è‡ª `AIAnalysisView.vue`
   - æ›´æ–° API ç«¯é»
   - æ›´æ–°æ¨™é¡Œå’Œå‰¯æ¨™é¡Œ

2. æ›´æ–°è·¯ç”± (`router/index.ts`)
   - æ–°å¢ `/advanced-analysis` è·¯ç”±

3. æ›´æ–° Navbar å’Œé å°¾
   - æ–°å¢ã€Œä½©ç’‡é€²éšåˆ†æã€é€£çµ

4. æœ¬åœ°æ¸¬è©¦
   ```bash
   npm run dev
   # ç€è¦½å™¨æ¸¬è©¦
   ```

5. æäº¤åˆ° Git
   ```bash
   git add bazi-app-vue/src/views/AdvancedAnalysisView.vue
   git add bazi-app-vue/src/router/index.ts
   git add bazi-app-vue/src/App.vue
   git commit -m "feat: add advanced analysis frontend view"
   ```

**é©—æ”¶æ¨™æº–**:
- âœ… å‰ç«¯é é¢æ­£å¸¸é¡¯ç¤º
- âœ… SSE streaming æ­£å¸¸æ¥æ”¶
- âœ… Markdown æ¸²æŸ“æ­£ç¢º
- âœ… ä»£ç¢¼å·²æäº¤åˆ° Git

---

### Iteration 5: æ•´åˆæ¸¬è©¦ (2-3h)
**ç›®æ¨™**: ç«¯åˆ°ç«¯æ¸¬è©¦å’Œå„ªåŒ–

**ä»»å‹™**:
1. æ•´åˆæ¸¬è©¦
   - å‰µå»ºæ¸¬è©¦å‘½ç›¤
   - æ¸¬è©¦å®Œæ•´æµç¨‹ï¼ˆé¦–æ¬¡è«‹æ±‚ + å¿«å–å‘½ä¸­ï¼‰
   - æ¸¬è©¦éŒ¯èª¤è™•ç†

2. æ€§èƒ½å„ªåŒ–
   - ç›£æ§ Gemini API èª¿ç”¨æ™‚é–“
   - å„ªåŒ– Prompt é•·åº¦
   - èª¿æ•´å¿«å–ç­–ç•¥

3. éŒ¯èª¤è™•ç†
   - API é…é¡ç”¨ç›¡æ™‚çš„é™ç´šç­–ç•¥
   - è¶…æ™‚è™•ç†
   - å‹å¥½çš„éŒ¯èª¤æç¤º

4. æ–‡æª”æ›´æ–°
   - API æ–‡æª”
   - ä½¿ç”¨æŒ‡å—
   - éƒ¨ç½²æŒ‡å—

5. æäº¤åˆ° Git
   ```bash
   git add doc/
   git commit -m "docs: add advanced analysis documentation"
   ```

**é©—æ”¶æ¨™æº–**:
- âœ… ç«¯åˆ°ç«¯æ¸¬è©¦é€šé
- âœ… æ€§èƒ½æŒ‡æ¨™é”æ¨™ï¼ˆ< 30sï¼‰
- âœ… éŒ¯èª¤è™•ç†å®Œå–„
- âœ… æ–‡æª”å®Œæ•´

---

## ğŸ§ª æ¸¬è©¦ç­–ç•¥

### æœ¬åœ°é–‹ç™¼ç’°å¢ƒ
```bash
# å•Ÿå‹•æœ¬åœ° Worker
cd peixuan-worker
wrangler dev

# å•Ÿå‹•å‰ç«¯é–‹ç™¼ä¼ºæœå™¨
cd bazi-app-vue
npm run dev
```

### æ¸¬è©¦å±¤ç´š
1. **å–®å…ƒæ¸¬è©¦**: æ¯å€‹å‡½æ•¸ç¨ç«‹æ¸¬è©¦
2. **æ•´åˆæ¸¬è©¦**: API ç«¯é»æ¸¬è©¦
3. **ç«¯åˆ°ç«¯æ¸¬è©¦**: å®Œæ•´æµç¨‹æ¸¬è©¦

### æ¸¬è©¦å·¥å…·
- Vitest: å–®å…ƒæ¸¬è©¦
- wrangler dev: æœ¬åœ°æ•´åˆæ¸¬è©¦
- curl: API æ¸¬è©¦
- ç€è¦½å™¨: å‰ç«¯æ¸¬è©¦

---

## ğŸš€ éƒ¨ç½²ç­–ç•¥

### ç’°å¢ƒéš”é›¢
1. **é–‹ç™¼ç’°å¢ƒ**: æœ¬åœ° (wrangler dev)
2. **æ¸¬è©¦ç’°å¢ƒ**: æš«ç„¡ï¼ˆæœªä¾†å¯å»ºç«‹ stagingï¼‰
3. **ç”Ÿç”¢ç’°å¢ƒ**: Cloudflare Workers

### éƒ¨ç½²æµç¨‹
1. æœ¬åœ°é–‹ç™¼å’Œæ¸¬è©¦
2. æäº¤ä»£ç¢¼åˆ° feature åˆ†æ”¯
3. å‰µå»º Pull Request
4. Code Review
5. åˆä½µåˆ° main åˆ†æ”¯
6. æ‰‹å‹•éƒ¨ç½²åˆ°ç”Ÿç”¢ç’°å¢ƒ

### éƒ¨ç½²æª¢æŸ¥æ¸…å–®
- [ ] æ‰€æœ‰æ¸¬è©¦é€šé
- [ ] ä»£ç¢¼å·²å¯©æŸ¥
- [ ] æ–‡æª”å·²æ›´æ–°
- [ ] ç§»é™¤æ‰€æœ‰èª¿è©¦ä»£ç¢¼
- [ ] ç§»é™¤æ‰€æœ‰æ¸¬è©¦ç«¯é»
- [ ] D1 migration å·²åŸ·è¡Œ
- [ ] ç’°å¢ƒè®Šæ•¸å·²é…ç½®
- [ ] å‚™ä»½è¨ˆåŠƒå·²æº–å‚™

---

## âš ï¸ é¢¨éšªç®¡ç†

### å·²çŸ¥é¢¨éšª

| é¢¨éšª | å½±éŸ¿ | æ©Ÿç‡ | ç·©è§£æªæ–½ |
|------|------|------|----------|
| Gemini API é…é¡ç”¨ç›¡ | HIGH | MEDIUM | å¯¦ä½œé™ç´šç­–ç•¥ã€ç›£æ§é…é¡ |
| Workers CPU è¶…æ™‚ | MEDIUM | LOW | å„ªåŒ–è¨ˆç®—é‚è¼¯ã€å¢åŠ è¶…æ™‚è™•ç† |
| D1 å¯«å…¥å¤±æ•— | MEDIUM | LOW | é‡è©¦æ©Ÿåˆ¶ã€éŒ¯èª¤æ—¥èªŒ |
| å‰ç«¯ SSE é€£æ¥ä¸­æ–· | LOW | MEDIUM | è‡ªå‹•é‡é€£ã€éŒ¯èª¤æç¤º |
| ä»£ç¢¼ä¸Ÿå¤± | HIGH | LOW | é »ç¹æäº¤åˆ° Git |

### é™ç´šç­–ç•¥
1. **Gemini API å¤±æ•—**: è¿”å›å¿«å–æˆ–å‹å¥½æç¤º
2. **è¨ˆç®—è¶…æ™‚**: è¿”å›éƒ¨åˆ†çµæœ
3. **D1 ä¸å¯ç”¨**: åƒ…è¿”å›è¨ˆç®—çµæœï¼Œä¸å¿«å–

---

## ğŸ“… æ™‚é–“è¡¨

### ç¸½æ™‚é–“ä¼°ç®—: 15-20 å°æ™‚

| è¿­ä»£ | ä»»å‹™ | é ä¼°æ™‚é–“ | ç‹€æ…‹ |
|------|------|----------|------|
| Iteration 1 | æ•¸æ“šå±¤ | 2-3h | â³ å¾…é–‹å§‹ |
| Iteration 2 | æ¥­å‹™é‚è¼¯å±¤ | 4-6h | â³ å¾…é–‹å§‹ |
| Iteration 3 | API å±¤ | 2-3h | â³ å¾…é–‹å§‹ |
| Iteration 4 | å‰ç«¯å±¤ | 2-3h | â³ å¾…é–‹å§‹ |
| Iteration 5 | æ•´åˆæ¸¬è©¦ | 2-3h | â³ å¾…é–‹å§‹ |
| Buffer | ç·©è¡æ™‚é–“ | 3-2h | - |

### é‡Œç¨‹ç¢‘
- **M1**: æ•¸æ“šå±¤å®Œæˆï¼ˆDay 1ï¼‰
- **M2**: æ¥­å‹™é‚è¼¯å±¤å®Œæˆï¼ˆDay 2-3ï¼‰
- **M3**: API å±¤å®Œæˆï¼ˆDay 4ï¼‰
- **M4**: å‰ç«¯å±¤å®Œæˆï¼ˆDay 5ï¼‰
- **M5**: æ•´åˆæ¸¬è©¦å®Œæˆï¼ˆDay 6ï¼‰
- **M6**: ç”Ÿç”¢éƒ¨ç½²ï¼ˆDay 7ï¼‰

---

## ğŸ“ é™„éŒ„

### åƒè€ƒæ–‡æª”
- [CHECKPOINTS.md](../.specify/memory/CHECKPOINTS.md): ä¹‹å‰çš„å¯¦ä½œè¨˜éŒ„
- [progress.md](../progress.md): é€²åº¦è¿½è¹¤
- [DECISIONS.md](../.specify/memory/DECISIONS.md): æ±ºç­–è¨˜éŒ„

### ç›¸é—œ Issues
- ç”Ÿç”¢ç’°å¢ƒæ¸¬è©¦å°è‡´æœå‹™ä¸ç©©å®š
- Gemini API é…é¡é™åˆ¶
- ä»£ç¢¼æœªæäº¤å°è‡´ä¸Ÿå¤±

### è¯çµ¡äºº
- é–‹ç™¼è€…: [Your Name]
- å¯©æŸ¥è€…: [Reviewer Name]

---

**æœ€å¾Œæ›´æ–°**: 2025-12-04 02:55  
**ä¸‹ä¸€æ¬¡å¯©æŸ¥**: Iteration 1 å®Œæˆå¾Œ
